<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ackordkollen</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: Arial, sans-serif; background:#f5f5f5; margin:0; padding:20px; }
    h1 { margin-top:0; }
    .card { background:#fff; padding:15px; border-radius:8px; margin-bottom:15px; }
    input, button { padding:10px; width:100%; margin-top:5px; }
    button { background:#0ea5e9; color:#fff; border:none; border-radius:6px; }
  </style>
</head>
<body>

<h1>Ackordkollen</h1>

<div class="card" id="auth">
  <h3>Logga in / Skapa konto</h3>
  <input id="email" placeholder="E-post">
  <input id="password" type="password" placeholder="Lösenord">
  <button onclick="login()">Logga in / Registrera</button>
</div>

<div class="card" id="app" style="display:none;">
  <h3>Projekt</h3>
  <input id="target" type="number" placeholder="Måltimmar (t.ex. 100)">
  <button onclick="saveTarget()">Spara mål</button>

  <h3>Lägg till timmar</h3>
  <input id="hours" type="number" placeholder="Antal timmar">
  <button onclick="addHours()">Lägg till</button>

  <p><b>Totalt arbetade timmar:</b> <span id="total">0</span></p>
  <p><b>Procent klart:</b> <span id="percent">0</span>%</p>
</div>

<script>
  const SUPABASE_URL = "https://zosugtnxitbhbnfsvsri.supabase.com";
  const SUPABASE_ANON_KEY = "sb_publishable_0eXrkM6bCiNaCKRz4OKp9Q_YgT40-lg" ;

  const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  async function login() {
    const email = email.value;
    const password = password.value;
    const { error } = await supabase.auth.signInWithPassword({ email, password });
    if (!error) start();
    else await supabase.auth.signUp({ email, password });
  }

  async function start() {
    document.getElementById("auth").style.display = "none";
    document.getElementById("app").style.display = "block";
    load();
  }

  async function saveTarget() {
    const t = Number(target.value);
    await supabase.from("settings").upsert({ id: 1, target: t });
    load();
  }

  async function addHours() {
    const h = Number(hours.value);
    await supabase.from("hours").insert({ hours: h });
    load();
  }

  async function load() {
    const { data: h } = await supabase.from("hours").select();
    const total = h?.reduce((s, r) => s + r.hours, 0) || 0;

    const { data: s } = await supabase.from("settings").select().eq("id",1).single();
    const target = s?.target || 0;

    document.getElementById("total").innerText = total;
    document.getElementById("percent").innerText =
      target ? Math.round((total / target) * 100) : 0;
  }

  supabase.auth.getSession().then(({ data }) => {
    if (data.session) start();
  });
</script>

</body>
</html>
